<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${memberDisplay} + ' Details'">Details</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; }
    h2 { color: #0d6efd; font-weight: 700; }
    .clickable { color: #0d6efd; cursor: pointer; text-decoration: underline; }
    .clickable:hover { color: #0a58ca; }
  </style>
</head>

<body>
<div class="container py-4">
  <h2 th:text="${memberDisplay} + ' - Details'"></h2>

  <!-- âœ… Special title for Gnanasri -->
  <h5 th:if="${memberId == 'gnanasri'}"
      class="text-success mt-2 mb-3">
    Customers handled by Employee #
    <span th:text="${key}"></span>
  </h5>

  <!-- âœ… Handle List safely -->
  <div th:if="${record instanceof T(java.util.List)} and ${#lists.size(record) > 0}">
    <table class="table table-bordered table-striped mt-3 shadow-sm">
      <thead class="table-primary text-center">
        <tr>
          <th th:each="k : ${record[0].keySet()}" th:text="${k}"></th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="r : ${record}">
          <td th:each="entry, stat : ${r.entrySet()}">

            <!-- ðŸŸ¦ SUNNY: productCode clickable (needs extraKey) -->
            <span th:if="${memberId == 'sunny' and entry.key == 'productCode'}"
                  th:text="${entry.value}"
                  class="clickable"
                  th:attr="onclick=|window.location.href='/member/details?member=${memberId}&key=${key}&extraKey=${entry.value}'|">
            </span>

            <!-- ðŸŸ© SOWMYA: productCode clickable (fetch vendor info) -->
            <span th:if="${memberId == 'sowmya' and entry.key == 'productCode'}"
                  th:text="${entry.value}"
                  class="clickable"
                  th:attr="onclick=|window.location.href='/member/details?member=${memberId}&key=${entry.value}'|">
            </span>

            <!-- ðŸ”¹ Default display -->
            <span th:if="${!( (memberId == 'sunny' and entry.key == 'productCode') or (memberId == 'sowmya' and entry.key == 'productCode') )}"
                  th:text="${entry.value}">
            </span>

          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- âœ… Handle Map safely -->
  <div th:if="${record instanceof T(java.util.Map)} and ${#maps.size(record) > 0}">
    <table class="table table-bordered table-sm mt-3 shadow-sm">
      <tbody>
        <tr th:each="entry : ${record.entrySet()}">
          <td th:text="${entry.key}"></td>
          <td th:text="${entry.value}"></td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- âœ… Fallback for empty record -->
  <div th:if="${record == null or (#lists.isEmpty(record) and #maps.isEmpty(record))}">
    <p class="text-muted">
      No data available for this selection
      <span th:if="${memberId == 'gnanasri'}"> (Employee #<span th:text="${key}"></span>)</span>.
    </p>
  </div>

  <!-- âœ… Summary / Totals -->
  <div class="mt-4 p-3 bg-light border rounded shadow-sm">
    <h5 class="text-primary mb-3">ðŸ“Š Summary / Totals</h5>

    <!-- Simple Number Summary -->
    <div th:if="${summary instanceof T(java.lang.Number)}">
      <p><strong>Total:</strong> <span th:text="${summary}"></span></p>
    </div>

    <!-- Map Summary -->
    <div th:if="${summary instanceof T(java.util.Map)} and ${#maps.size(summary) > 0}">
      <table class="table table-bordered table-sm">
        <tbody>
          <tr th:each="entry : ${summary.entrySet()}">
            <td th:text="${entry.key}"></td>
            <td th:text="${entry.value}"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- List Summary -->
    <div th:if="${summary instanceof T(java.util.List)} and ${#lists.size(summary) > 0}">
      <table class="table table-bordered table-striped mt-3">
        <thead class="table-secondary">
          <tr>
            <th th:each="k : ${summary[0].keySet()}" th:text="${k}"></th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="r : ${summary}">
            <td th:each="v : ${r.values()}" th:text="${v}"></td>
          </tr>
        </tbody>
      </table>
    </div>

    <div th:if="${summary == null}">
      <p class="text-muted">No summary data yet. (Click Product Code if applicable)</p>
    </div>
  </div>

  <!-- âœ… Back Button -->
  <div class="text-center mt-4">
    <a th:href="@{/index}" class="btn btn-secondary px-4">Back to Home</a>
  </div>
</div>
</body>
</html>
